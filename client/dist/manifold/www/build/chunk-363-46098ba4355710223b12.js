"use strict";(self.webpackChunkmanifold_client=self.webpackChunkmanifold_client||[]).push([[363],{87363:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var n=r(96540),s=r(5556),i=r.n(s),a=r(32389),o=r(81147),d=r(99786),l=r(9176),c=r(85842),p=r(54625),g=r(49448),u=r(98),x=r(74848);function h(e){let{entry:t,depth:r,innerRef:n,draggableProps:s,dragHandleProps:i,isDragging:o,isdropTarget:d,textId:l,onDelete:h,onCollapse:m,onExpand:b}=e;const{t:j}=(0,a.Bd)(),f=g.A.link("backendTextTOCEntryEdit",l,t.id),y=t.isExpanded?m:b,I=t.isExpanded?"DisclosureUp32":"DisclosureDown32";return(0,x.jsx)(u.q7,{ref:n,...s,children:(0,x.jsxs)(u.Rp,{$isDragging:o,$depth:r,$isTarget:d,children:[(0,x.jsxs)(u.e2,{children:[(0,x.jsx)(u.$n,{onClick:()=>h(t.id),"aria-label":j("actions.delete"),children:(0,x.jsx)(c.A.IconComposer,{size:24,icon:"delete24"})}),(0,x.jsx)(u.$n,{as:p.N_,to:f,"aria-label":j("actions.edit"),children:(0,x.jsx)(c.A.IconComposer,{size:24,icon:"annotate24"})}),(0,x.jsx)(u.tk,{"aria-describedby":"toc-drag-handle-instructions",...i,children:(0,x.jsx)(c.A.IconComposer,{size:30,icon:"grabber32"})})]}),(0,x.jsxs)(u.aW,{children:[t.hasChildren&&(0,x.jsx)(u.$n,{onClick:y,"aria-label":j("actions.edit"),style:{marginBlockStart:"2px"},children:(0,x.jsx)(c.A.IconComposer,{size:28,icon:I})}),(0,x.jsx)(u.hE,{children:t.data?t.data.title:""}),!!r&&(0,x.jsx)(u.rl,{icon:"tocLink16"})]})]})})}h.displayName="Text.TOC.List.Entry",h.propTypes={entry:i().object.isRequired,depth:i().number.isRequired,innerRef:i().func,draggableProps:i().object,dragHandleProps:i().object,isDragging:i().bool,setCombine:i().func,combine:i().string,textId:i().string,onDelete:i().func,isStart:i().bool,onSetStart:i().func};var m=r(99363),b=r(92151),j=r(3597);function f(e){let{tree:t,setTree:r,textId:s,error:i,setError:c}=e;const{t:p}=(0,a.Bd)(),[g,f]=(0,n.useState)(!1),[y,I]=(0,n.useState)(Object.keys(t.items).length-1),[C,D]=(0,n.useState)(Object.keys(t.items).length-1),T=(0,j.pP)(b.VK.update),k=async e=>{c(null);const n=[e,...(0,m.TA)(e,t.items)],i=(0,m.$3)(n,t.items),a=(0,m.O2)({...t,items:i}),o=await T(s,{attributes:{toc:a}});if(null!=o&&o.errors)return c(o.errors);r((0,m.UI)(a))},E="reorder"===i?p("errors.toc_reorder"):Array.isArray(i)?i.map((e=>e.detail)).join(". "):i;return t?(0,x.jsxs)(u.mO,{className:"full-width",$count:y,children:[i&&(0,x.jsx)(u.$D,{children:E}),g&&(0,x.jsx)(u.mR,{$count:C}),(0,x.jsxs)(u.P,{$count:Object.keys(t.items).length-1,children:[(0,x.jsx)(l.A,{tree:t,renderItem:e=>{let{item:n,provided:i,snapshot:a,depth:o}=e;const l=i.dragHandleProps;delete l["aria-roledescription"];return(0,x.jsx)(h,{entry:n,depth:o,innerRef:i.innerRef,draggableProps:i.draggableProps,dragHandleProps:l,isDragging:a.isDragging,isdropTarget:a.combineTargetFor,placeholder:i.placeholder,textId:s,onDelete:k,onCollapse:()=>{const e=(0,d.r)(t,n.id,{isExpanded:!1});r(e);const s=(0,m.p3)(n,e.items);I(y-s)},onExpand:()=>{const e=(0,d.r)(t,n.id,{isExpanded:!0});r(e);const s=(0,m.p3)(e.items[n.id],e.items);I(y+s)}})},onDragStart:e=>{f(!0);const r=(0,m.p3)(t.items[e],t.items);D(y-r)},onDragEnd:async(e,n)=>{let i;if(f(!1),"root"===n.parentId&&isNaN(n.index)){i={parentId:"root",index:(0,m.cf)(e.parentId,t.items)+1}}else i=(0,m.t4)(n.parentId,t.items)?n:{parentId:(0,m.oO)(n.parentId,t.items)};const a=(0,o.o)(t,e,i);(async e=>{c(null);const t=(0,m.O2)(e),r=await T(s,{attributes:{toc:t}});null!=r&&r.errors&&c("reorder")})(a),r(a)},isDragEnabled:!0,isNestingEnabled:!0,offsetPerLevel:0}),(0,x.jsx)("span",{className:"screen-reader-text",id:"toc-drag-handle-instructions",children:p("texts.toc.drag_handle_instructions")})]})]}):null}f.displayName="Text.TOC.List",f.propTypes={tree:i().object.isRequired,setTree:i().func.isRequired,textId:i().string.isRequired}}}]);
//# sourceMappingURL=chunk-363-46098ba4355710223b12.js.map